<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>單字計劃表</title>
  <style type="text/css">
  a{text-decoration: none;color:#39f; }
  body{width: 988px; margin: 0 auto;}
  th{text-align: right; font-size: 14px; color: #666;width: 100px;}
  td{font-size: 12px;color: #999;padding: 3px 0;}
  input{width: 136px;}
  input[type=checkbox]{width:auto;}
  h1{text-align: center;}
  #sidebar{float: left;width: 270px;margin-right: 10px;margin-top: 70px;}
  #output{width: 707px;font-family: Verdana;float: left;font-size: 12px;}
  #output>span{
    width: 100px;
    float: left;
    height: 20px;
    border: 1px solid #aaa;
    border-left: none;
    text-align: center;
  }
  #output{border-left: 1px solid #aaa;}
  #calendar>div{
    width: 97px;
    height: 114px;
    float: left;
    padding-left: 3px;
    border-right: 1px solid #aaa;
    border-bottom: 1px solid #aaa;
  }
  @media print{form{display: none;}body{width: 708px;}}
  </style>
<body>
<form id="sidebar" style="height: auto !important;">
   <table>
     <tbody>
     <tr><th>計劃名</th><td><input id="plan" value="計劃表"></td></tr>
     <tr><th>List 名</th><td><input id="book" value="L"></td></tr>
     <tr><th>開始日期</th><td><input id="startDate" type="date"></td></tr>
     <tr><th>每天 List 數</th><td><input id="listPerDay" value="2"></td></tr>
     <tr><th>List 總數</th><td><input id="totalList" value="42"><br></td></tr>
     <tr><th>是否反向</th><td><input id="reverse" type="checkbox"></td></tr>
     <tr>
        <th></th>
        <td>
          <button id="generate">排定計劃表</button>
          <button type="button" onclick="javascript:window.print()">列印</button>
          <button id="calendar-download">日曆表</button>
        </td>
      </tr>
     <tr><td colspan="2">註1：本工具根據最新《<a href="http://www.amazon.cn/gp/product/B0011C0ZQ0/ref=as_li_ss_tl?ie=UTF8&amp;camp=536&amp;creative=3132&amp;creativeASIN=B0011C0ZQ0&amp;linkCode=as2&amp;tag=shawphy-23">17天搞定GRE單詞</a>》第二版中，第35頁上的21天時間表，動態生成時間表。時間間隔為1,2,4,7,15天。與網上流傳的老版掃描版略有不同。</td></tr>
     <tr><td colspan="2">註2：列表中打星號的表示複習。按照原書的建議，上午學習新的list，下午或者晚上複習打星號的list。背完或者複習完就可以劃掉增加成就感。</td></tr>
     <tr><td colspan="2">註3：本頁面可以直接列印，列印的時候不會有側邊欄。實在無法直接列印就截圖放到word裡列印吧。</td></tr>
     <tr><td colspan="2">註4：本工具建議使用 <a href="http://www.google.com/intl/zh-CN/chrome/browser/">Chrome流覽器</a> 訪問。IE 10 以下版本不保證正常使用。 </td></tr>
     <tr><td colspan="2">註5：祝大家考試順利！</td></tr>
   </tbody></table>
  <br>
</form>
<h1>計劃表</h1>
<div id="output">
  <span>Sun</span>
  <span>Mon</span>
  <span>Tue</span>
  <span>Wed</span>
  <span>Thu</span>
  <span>Fri</span>
  <span>Sat</span>
  <div id="calendar"><div>11/10</div><div>11/11</div><div>11/12</div><div>11/13<br>&nbsp;&nbsp;L 1~2<br>*L 1~2</div><div>11/14<br>&nbsp;&nbsp;L 3~4<br>*L 1~2<br>*L 3~4</div><div>11/15<br>&nbsp;&nbsp;L 5~6<br>*L 3~4<br>*L 5~6</div><div>11/16<br>&nbsp;&nbsp;L 7~8<br>*L 1~2<br>*L 5~6<br>*L 7~8</div><div>11/17<br>&nbsp;&nbsp;L 9~10<br>*L 3~4<br>*L 7~8<br>*L 9~10</div><div>11/18<br>&nbsp;&nbsp;L 11~12<br>*L 5~6<br>*L 9~10<br>*L 11~12</div><div>11/19<br>&nbsp;&nbsp;L 13~14<br>*L 7~8<br>*L 11~12<br>*L 13~14</div><div>11/20<br>&nbsp;&nbsp;L 15~16<br>*L 1~2<br>*L 9~10<br>*L 13~14<br>*L 15~16</div><div>11/21<br>&nbsp;&nbsp;L 17~18<br>*L 3~4<br>*L 11~12<br>*L 15~16<br>*L 17~18</div><div>11/22<br>&nbsp;&nbsp;L 19~20<br>*L 5~6<br>*L 13~14<br>*L 17~18<br>*L 19~20</div><div>11/23<br>&nbsp;&nbsp;L 21~22<br>*L 7~8<br>*L 15~16<br>*L 19~20<br>*L 21~22</div><div>11/24<br>&nbsp;&nbsp;L 23~24<br>*L 9~10<br>*L 17~18<br>*L 21~22<br>*L 23~24</div><div>11/25<br>&nbsp;&nbsp;L 25~26<br>*L 11~12<br>*L 19~20<br>*L 23~24<br>*L 25~26</div><div>11/26<br>&nbsp;&nbsp;L 27~28<br>*L 13~14<br>*L 21~22<br>*L 25~26<br>*L 27~28</div><div>11/27<br>&nbsp;&nbsp;L 29~30<br>*L 1~2<br>*L 15~16<br>*L 23~24<br>*L 27~28<br>*L 29~30</div><div>11/28<br>&nbsp;&nbsp;L 31~32<br>*L 3~4<br>*L 17~18<br>*L 25~26<br>*L 29~30<br>*L 31~32</div><div>11/29<br>&nbsp;&nbsp;L 33~34<br>*L 5~6<br>*L 19~20<br>*L 27~28<br>*L 31~32<br>*L 33~34</div><div>11/30<br>&nbsp;&nbsp;L 35~36<br>*L 7~8<br>*L 21~22<br>*L 29~30<br>*L 33~34<br>*L 35~36</div><div>12/1<br>&nbsp;&nbsp;L 37~38<br>*L 9~10<br>*L 23~24<br>*L 31~32<br>*L 35~36<br>*L 37~38</div><div>12/2<br>&nbsp;&nbsp;L 39~40<br>*L 11~12<br>*L 25~26<br>*L 33~34<br>*L 37~38<br>*L 39~40</div><div>12/3<br>&nbsp;&nbsp;L 41~42<br>*L 13~14<br>*L 27~28<br>*L 35~36<br>*L 39~40<br>*L 41~42</div><div>12/4<br>*L 15~16<br>*L 29~30<br>*L 37~38<br>*L 41~42</div><div>12/5<br>*L 17~18<br>*L 31~32<br>*L 39~40</div><div>12/6<br>*L 19~20<br>*L 33~34<br>*L 41~42</div><div>12/7<br>*L 21~22<br>*L 35~36</div><div>12/8<br>*L 23~24<br>*L 37~38</div><div>12/9<br>*L 25~26<br>*L 39~40</div><div>12/10<br>*L 27~28<br>*L 41~42</div><div>12/11<br>*L 29~30</div><div>12/12<br>*L 1~2<br>*L 31~32</div><div>12/13<br>*L 3~4<br>*L 33~34</div><div>12/14<br>*L 5~6<br>*L 35~36</div><div>12/15<br>*L 7~8<br>*L 37~38</div><div>12/16<br>*L 9~10<br>*L 39~40</div><div>12/17<br>*L 11~12<br>*L 41~42</div><div>12/18<br>*L 13~14</div><div>12/19<br>*L 15~16</div><div>12/20<br>*L 17~18</div><div>12/21<br>*L 19~20</div><div>12/22<br>*L 21~22</div><div>12/23<br>*L 23~24</div><div>12/24<br>*L 25~26</div><div>12/25<br>*L 27~28</div><div>12/26<br>*L 29~30</div><div>12/27<br>*L 31~32</div><div>12/28<br>*L 33~34</div><div>12/29<br>*L 35~36</div><div>12/30<br>*L 37~38</div><div>12/31<br>*L 39~40</div><div>1/1<br>*L 41~42</div></div>
</div>
<script src="./static/js/jquery-2.1.4.min.js"></script>
<script>
  $("#startDate").val(new Date().toJSON().slice(0,10));
  $("#generate").click(function() {
    var book=$("#book").val();
    var startDate=$("#startDate").val();
    var listPerDay=$("#listPerDay").val()-0;
    var totalList=$("#totalList").val()-0;
    var weekday=new Date(startDate).getDay();
    var firstLineSunday=new Date(new Date(startDate)-weekday*86400000);
    var calendar=$("#calendar").empty();
    var reverse=$("#reverse").prop("checked");

    $("h1").text($("#plan").val())
    for (var i = 0,l=totalList/listPerDay+29+weekday; i<l; i++) {
      currentDay=new Date(firstLineSunday-0+i*86400000);
      calendar.append("<div>"+(currentDay.getMonth()-0+1)+"/"+currentDay.getDate()+"</div>")
    };

    var plan=[];
    for (var i = 0,l=totalList/listPerDay; i <l; i++) {
      tmp=[];
      for (var j = 1; j <= listPerDay; j++) {
        k=i*listPerDay+j;
        if (k>totalList) break;
        tmp.push(k)
      };
      if(tmp.length==1){
        str=tmp[0]
      } else {
        str=tmp.shift()+"~"+tmp.pop();
      }
      plan.push(str);
    };
    for (var i = 0,l=plan.length; i < l; i++) {
      calendar.children().eq(weekday+i).append("<br>&nbsp;&nbsp;"+book+" "+plan[reverse?l-i-1:i])
    };
    var plan=[];
    for (var i = 0,l=totalList/listPerDay; i <l; i++) {
      tmp=[];
      for (var j = 1; j <= listPerDay; j++) {
        k=i*listPerDay+j;
        if (k>totalList) break;
        tmp.push(k)
      };
      if(tmp.length==1){
        str=tmp[0]
      } else {
        str=tmp.shift()+"~"+tmp.pop();
      }
      plan.push(str);
    };
    for (var i = 0,l=plan.length; i < l; i++) {
      calendar.children().eq(weekday+i).append("<br>*"+book+" "+plan[reverse?l-i-1:i])
      calendar.children().eq(weekday+i+1).append("<br>*"+book+" "+plan[reverse?l-i-1:i])
      calendar.children().eq(weekday+i+3).append("<br>*"+book+" "+plan[reverse?l-i-1:i])
      calendar.children().eq(weekday+i+7).append("<br>*"+book+" "+plan[reverse?l-i-1:i])
      calendar.children().eq(weekday+i+14).append("<br>*"+book+" "+plan[reverse?l-i-1:i])
      calendar.children().eq(weekday+i+29).append("<br>*"+book+" "+plan[reverse?l-i-1:i])
    };
    return false;
  });//.click();

  function dateformat(dt) {
    return dt.getFullYear() + '-' +  ('0' + (dt.getMonth()+1)).slice(-2) + '-' + ('0' + dt.getDate()).slice(-2);
  }
  function saveAScsv(csv, filename) {
    let blob = new Blob([csv], { type: "text/csv" });
    // Determine which approach to take for the download
    if (navigator.msSaveOrOpenBlob) {
      navigator.msSaveOrOpenBlob(blob, filename + '.csv');
    } else {
      let anchor = document.body.appendChild(document.createElement('a'));
      if ('download' in anchor) {
        anchor.download = filename + '.csv';
        anchor.href = URL.createObjectURL(blob);
        anchor.click();
      }
    }
  }
  $('#calendar-download').click(function() {
    var book=$("#book").val();
    var startDate=$("#startDate").val();
    var listPerDay=$("#listPerDay").val()-0;
    var totalList=$("#totalList").val()-0;
    var reverse=$("#reverse").prop("checked");
    var lst = []
    var plan=[];
    for (var i = 0,l=totalList/listPerDay; i <l; i++) {
      tmp=[];
      for (var j = 1; j <= listPerDay; j++) {
        k=i*listPerDay+j;
        if (k>totalList) break;
        tmp.push(k)
      };
      if(tmp.length==1){
        str=tmp[0]
      } else {
        str=tmp.shift()+"~"+tmp.pop();
      }
      plan.push(str);
    };
    var reviews = [0, 1, 3, 7, 14, 29];
    var dt = new Date(startDate);
    for (var i = 0,l=plan.length; i < l; i++) {
      dt = new Date(startDate);
      dt.setDate(new Date(startDate).getDate() +  parseInt(i));
      lst.push([book + ' ' + plan[i],dateformat(dt), '08:00', dateformat(dt), '19:00', 0]);

      // review
      for (var w = 0, ln = reviews.length; w < ln; w++) {
        dt.setDate(new Date(startDate).getDate() + parseInt(i + reviews[w]));
        lst.push(['*' + book + ' ' + plan[i], dateformat(dt), '13:00', dateformat(dt), '19:00', ln - w]);
      }
    }
    console.log(lst);
    lst.sort(function(a, b) {
      if (a[1] > b[1]) {
        return 1;
      } else if (a[1] < b[1]) {
        return -1;
      } else {
        return (a[5] > b[5] ? 1 : -1);
      }
    });
    let csvcontent = 'Subject,Start Date, Start Time,End Date, End Time,Description\r\n';
    let filename = $("#plan").val();
    for (var i = 0, l = lst.length; i < l; i++) {
      csvcontent += (lst[i][0] + ', ' + lst[i][1] + ', ' + lst[i][2] + ', ' + lst[i][3] + ', ' + lst[i][4]+ '\r\n');
    }
    saveAScsv(csvcontent, filename);
        // let jsondata = flowy.output();
    // let a = document.createElement('a');
    // let file = new Blob([JSON.stringify(jsondata)], { type: 'application/json' });
    // a.href = URL.createObjectURL(file);
    // a.download = 'flowchart.json';
    // a.click();
    return false;
  });
</script>